{"version":3,"sources":["app.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"app.js","sourcesContent":["var TAIPING = TAIPING || {};\r\n\r\n(function ($) {\r\n    $.ajaxSetup({\r\n        headers: {\r\n            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\r\n        }\r\n    });\r\n})(jQuery);\r\n\r\nTAIPING.select2 = (function ($) {\r\n\r\n    var ajaxDefaultSetting = {\r\n        minimumInputLength: 1,\r\n        ajax: {\r\n            dataType: 'json',\r\n            delay: 250,\r\n            processResults: function (data, page) {\r\n                return {\r\n                    results: $.map(data, function (item) {\r\n                        return {\r\n                            id: item.id,\r\n                            text: item.name\r\n                        };\r\n                    })\r\n                };\r\n            }\r\n        },\r\n        language: {\r\n            inputTooShort: function () {\r\n                return \"最少須輸入 1 個字\";\r\n            }\r\n        }\r\n    };\r\n\r\n    return {\r\n        init: function (selector, autocomplete, settings) {\r\n            this.config = settings || {};\r\n\r\n            if (autocomplete) {\r\n                $.extend(true, this.config, ajaxDefaultSetting);\r\n            }\r\n\r\n            this.setup(selector);\r\n        },\r\n        setup: function (selector) {\r\n            $(selector).select2(this.config);\r\n        }\r\n    };\r\n\r\n})(jQuery);\r\n\r\n// Create Switchings\r\nTAIPING.createClassSwitching = (function ($) {\r\n\r\n    var count = 0,\r\n\r\n        initSelect2 = function () {\r\n            var settings = {\r\n                ajax: {\r\n                    url: '/api/users/names'\r\n                }\r\n            };\r\n\r\n            TAIPING.select2.init('.class_list', false);\r\n            TAIPING.select2.init('.teacher_list', true, settings);\r\n            TAIPING.select2.init('.period', false, {\r\n                minimumResultsForSearch: Infinity\r\n            });\r\n        },\r\n\r\n        destroySelect2 = function () {\r\n            var i = 0,\r\n                className = ['.class_list', '.teacher_list', '.period'];\r\n\r\n            for (i = 0; i < className.length; i++) {\r\n                $(className[i]).each(function (index, element) {\r\n                    $(this).select2('destroy');\r\n                });\r\n            }\r\n        },\r\n\r\n        addClassSwitching = function () {\r\n            $('#addClassSwitchingForm').click(function () {\r\n                destroySelect2();\r\n\r\n                var $cloneForm = $('.classSwitchingForm').first().clone(true);\r\n                count += 1;\r\n                $cloneForm.insertBefore('#back');\r\n\r\n                initSelect2();\r\n            });\r\n        },\r\n\r\n        removeClassSwitching = function () {\r\n            $('.panel-body').on('click', 'button.close', function () {\r\n                if (count === 0) {\r\n                    return;\r\n                }\r\n                $(this).parents('.classSwitchingForm').remove();\r\n                count -= 1;\r\n            });\r\n        },\r\n\r\n        setRequestFieldName = function () {\r\n            $('.classSwitchingForm').each(function (index, val) {\r\n                $(val).find('.form-control').attr('name', function (i, val) {\r\n                    return val.replace(/(classSwitching)\\[\\d+\\]\\[(\\w+)\\]/g, '$1[' + index + '][$2]');\r\n                });\r\n            });\r\n        },\r\n\r\n        submitForm = function () {\r\n            $('button[type=submit]').click(function (event) {\r\n                destroySelect2();\r\n                setRequestFieldName();\r\n            });\r\n        };\r\n\r\n    return {\r\n        init: function () {\r\n            initSelect2();\r\n            addClassSwitching();\r\n            removeClassSwitching();\r\n            submitForm();\r\n        }\r\n    };\r\n\r\n})(jQuery);\r\n\r\n\r\nTAIPING.bootgrid = (function ($) {\r\n\r\n    var config = {\r\n        ajaxSettings: {\r\n            method: 'GET'\r\n        },\r\n        labels: {\r\n            refresh: '重新載入',\r\n            loading: '載入中...',\r\n            search: '搜尋老師',\r\n            noResults: '無搜尋結果！',\r\n            infos: '第 {{ctx.start}} 筆 至 第 {{ctx.end}} 筆，共 {{ctx.total}} 筆'\r\n        }\r\n    };\r\n\r\n    return {\r\n        init: function (selector, settings, loadedCallback) {\r\n            var settings = settings || {},\r\n                grid;\r\n\r\n            $.extend(true, config, settings);\r\n\r\n            grid = $(selector).bootgrid(config);\r\n            if (loadedCallback !== undefined) {\r\n                grid.on('loaded.rs.jquery.bootgrid', loadedCallback);\r\n            }\r\n\r\n            return grid;\r\n        }\r\n    };\r\n})(jQuery);\r\n\r\nTAIPING.downloadRequest = (function ($) {\r\n\r\n    return {\r\n        init: function (link, params) {\r\n\r\n            var dlink = link;\r\n            if (params !== undefined) {\r\n                dlink += '?' + $.param(params);\r\n            }\r\n\r\n            var $iframe = $(\"<iframe style='display:none' />\");\r\n            $iframe.attr(\"src\", dlink);\r\n            $iframe.appendTo(\"body\");\r\n            $iframe.on('load', function () {\r\n                // The load event will be triggered if the download link return a page.\r\n                alert('下載失敗！');\r\n            });\r\n        }\r\n    };\r\n})(jQuery);\r\n\r\n// TODO: Pass a modal trigger as argument when show this modal.\r\nTAIPING.deleteResourceModal = (function ($) {\r\n    var $modal = null,\r\n        resourceUrl = '',\r\n        config = {\r\n            method: 'DELETE',\r\n            dataType: 'json',\r\n            success: function (data) {\r\n                var noTarget = '-1';\r\n                $modal.modal('hide');\r\n                $modal.data('target-id', noTarget);\r\n            },\r\n            error: function (xhr, textStatus) {\r\n                alert(textStatus);\r\n                console.log(xhr.responseText);\r\n            }\r\n        };\r\n\r\n    var setResourceUrl = function (url) {\r\n            if (url === undefined || !url) {\r\n                throw {\r\n                    message: 'Resource url is invalid.'\r\n                };\r\n            }\r\n\r\n            if (url.indexOf('/', 1) === -1) { // Ignore first slash.\r\n                resourceUrl = url + '/';\r\n            }\r\n\r\n            resourceUrl = url;\r\n        },\r\n\r\n        setRequestUrl = function (targetID) {\r\n            config.url = resourceUrl + targetID;\r\n        };\r\n\r\n    return {\r\n        init: function (selector, url, complete) {\r\n            $modal = $(selector);\r\n            $modal.find('.confirm').on('click', function (e) {\r\n                $.ajax(config);\r\n            });\r\n\r\n            setResourceUrl(url);\r\n\r\n            if (complete !== undefined && typeof complete === 'function') {\r\n                config.complete = complete;\r\n            }\r\n\r\n            return this;\r\n        },\r\n        show: function (targetID) {\r\n            setRequestUrl(targetID);\r\n\r\n            $modal.data('target-id', targetID);\r\n            $modal.modal('show');\r\n        }\r\n    };\r\n})(jQuery);\r\n\r\nTAIPING.postResourceRequest = (function ($) {\r\n    var config = {\r\n        method: 'POST',\r\n        dataType: 'json',\r\n        beforeSend: function () {\r\n            $('p.collapse').hide();\r\n            var subject = $('#content').val().trim();\r\n            if (subject === '') {\r\n                $('p.text-danger').fadeIn(150);\r\n                return false;\r\n            }\r\n        },\r\n        success: function (data) {\r\n            $('p.text-success').fadeIn(150);\r\n        },\r\n        error: function (xhr, textStatus) {\r\n            $('p.text-danger').fadeIn(150);\r\n            console.log(xhr.responseText);\r\n        }\r\n    };\r\n\r\n    return {\r\n        send: function (url, data) {\r\n            if (!url || url === undefined ||\r\n                !data || data === undefined) {\r\n                throw {\r\n                    message: 'Invalid url or data.'\r\n                }\r\n            }\r\n\r\n            config.url = url;\r\n            config.data = data;\r\n\r\n            $.ajax(config);\r\n        }\r\n    };\r\n\r\n})(jQuery);"],"sourceRoot":"/source/"}